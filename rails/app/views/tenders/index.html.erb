<% content_for :title, "Tenders" %>

<div class="w-full">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <div class="flex justify-between items-center mb-6">
    <h1 class="font-bold text-4xl">Tenders</h1>
    <%= link_to "New tender", new_tender_path, class: "rounded-md px-3.5 py-2.5 bg-blue-600 hover:bg-blue-500 text-white block font-medium" %>
  </div>

  <div id="tenders" class="overflow-x-auto">
    <% if @tenders.any? %>
      <table class="w-full border-collapse">
        <thead>
          <tr class="bg-gray-100 border-b border-gray-300">
            <th class="px-4 py-3 text-left font-semibold text-gray-700">E-Number</th>
            <th class="px-4 py-3 text-left font-semibold text-gray-700">Client Name</th>
            <th class="px-4 py-3 text-left font-semibold text-gray-700">Tender Value</th>
            <th class="px-4 py-3 text-left font-semibold text-gray-700">Project Type</th>
            <th class="px-4 py-3 text-left font-semibold text-gray-700">Status</th>
            <th class="px-4 py-3 text-center font-semibold text-gray-700">File</th>
            <th class="px-4 py-3 text-left font-semibold text-gray-700">Created</th>
            <th class="px-4 py-3 text-center font-semibold text-gray-700">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @tenders.order(created_at: :desc).each do |tender| %>
            <tr class="border-b border-gray-200 hover:bg-gray-50 transition">
              <td class="px-4 py-3 text-blue-600 font-medium"><%= link_to tender.e_number, tender_path(tender), class: "hover:underline" %></td>
              <td class="px-4 py-3"><%= tender.client_name %></td>
              <td class="px-4 py-3"><%= number_to_currency(tender.tender_value) if tender.tender_value %></td>
              <td class="px-4 py-3"><%= tender.project_type %></td>
              <td class="px-4 py-3">
                <% if tender.status.present? %>
                  <span class="inline-block px-2.5 py-0.5 rounded-full text-xs font-medium <%= case tender.status when 'Won' then 'bg-green-100 text-green-800' when 'Lost' then 'bg-red-100 text-red-800' else 'bg-yellow-100 text-yellow-800' end %>">
                    <%= tender.status %>
                  </span>
                <% end %>
              </td>
              <td class="px-4 py-3 text-center">
                <% if tender.qob_file.attached? %>
                  <div class="flex items-center justify-center gap-2">
                    <i class="fa-regular fa-clipboard text-gray-600"></i>
                    <% filename = tender.qob_file.filename.to_s %>
                    <% truncated = filename.length > 20 ? filename[0..7] + "..." + filename[-8..-1] : filename %>
                    <%= link_to truncated, rails_blob_path(tender.qob_file, disposition: "attachment"), class: "text-blue-600 hover:text-blue-800 text-sm font-medium", title: filename %>
                  </div>
                <% else %>
                  <span class="text-gray-400 text-sm">â€”</span>
                <% end %>
              </td>
              <td class="px-4 py-3 text-sm text-gray-600"><%= tender.created_at.strftime('%b %d, %Y') %></td>
              <td class="px-4 py-3 text-center">
                <div class="flex gap-2 justify-center">
                  <%= link_to "View", tender_path(tender), class: "text-blue-600 hover:text-blue-800 font-medium" %>
                  <%= link_to "Edit", edit_tender_path(tender), class: "text-gray-600 hover:text-gray-800 font-medium" %>
                  <%= button_to "Delete", tender_path(tender), method: :delete, class: "text-red-600 hover:text-red-800 font-medium", data: { turbo_confirm: "Are you sure?" } %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <div class="text-center py-12">
        <p class="text-gray-500 text-lg">No tenders found.</p>
        <%= link_to "Create the first tender", new_tender_path, class: "inline-block mt-4 rounded-md px-3.5 py-2.5 bg-blue-600 hover:bg-blue-500 text-white font-medium" %>
      </div>
    <% end %>
  </div>
</div>
